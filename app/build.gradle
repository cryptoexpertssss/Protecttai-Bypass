plugins {
    alias(libs.plugins.android.application)
}

import java.util.Base64

android {
    namespace 'com.sch.pai.bypass'
    compileSdk 34

    defaultConfig {
        applicationId "com.sch.pai.bypass"
        minSdk 24
        targetSdk 34
        
        def runNumberStr = System.getenv("GITHUB_RUN_NUMBER")
        def vCode = 100
        def vNameSuffix = "local"
        if (runNumberStr != null && !runNumberStr.isEmpty()) {
            if (runNumberStr.isInteger()) {
                vCode = runNumberStr.toInteger()
            }
            vNameSuffix = runNumberStr
        }
        
        versionCode vCode
        versionName "2.0-b" + vNameSuffix

        testInstrumentationRunner "androidx.test.runner.AndroidJUnitRunner"
    }

    signingConfigs {
        release {
            storeFile file("release.keystore")
            storePassword "shekhar123"
            keyAlias "shekhar"
            keyPassword "shekhar123"
        }
    }

    buildTypes {
        release {
            minifyEnabled false
            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'
            signingConfig signingConfigs.release
        }
    }
    compileOptions {
        sourceCompatibility JavaVersion.VERSION_1_8
        targetCompatibility JavaVersion.VERSION_1_8
    }
}

dependencies {
    compileOnly files('libs/api-82.jar')
    implementation libs.appcompat
    implementation libs.material
    testImplementation libs.junit
    androidTestImplementation libs.ext.junit
    androidTestImplementation libs.espresso.core
}

task generateKeystore {
    doLast {
        def keystoreFile = file("release.keystore")
        if (!keystoreFile.exists()) {
            println "Generating release.keystore from inline base64..."
            def b64 = "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"
            keystoreFile.setBytes(Base64.getDecoder().decode(b64))
        }
    }
}

preBuild.dependsOn generateKeystore